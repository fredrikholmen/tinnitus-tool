<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tinnitus pitch match</title>
    <style>
      body { font-family: system-ui, sans-serif; max-width: 860px; margin: 24px auto; padding: 0 16px; }
      .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin: 12px 0; }
      button { padding: 10px 14px; border-radius: 10px; border: 1px solid #ccc; cursor: pointer; }
      button:disabled { opacity: .5; cursor: not-allowed; }
      .row { display:flex; gap: 10px; flex-wrap: wrap; align-items:center; }
      code { background: #f6f6f6; padding: 2px 6px; border-radius: 6px; }
      input[type="range"] { width: 320px; }
    </style>
  </head>
  <body>
    <h1>Tinnitus pitch match (local)</h1>

    <div class="card">
      <p><strong>Safety:</strong> start at low volume. Stop if uncomfortable. Use headphones.</p>
      <div class="row">
        <button id="btnInit">Enable audio</button>
        <button id="btnCalTone" disabled>Play 1 kHz calibration tone</button>
        <label>Master level: <input id="master" type="range" min="0" max="1" step="0.001" value="0.08"></label>
        <span id="masterVal"></span>
      </div>
    </div>

    <div class="card">
      <h2>Step 1 — Tone vs noise-like?</h2>
      <p>We’ll compare a pure tone vs narrowband noise at the current estimate. Pick which is closer to your tinnitus.</p>
      <div class="row">
        <button id="btnTNStart" disabled>Start (tone vs noise)</button>
        <button id="btnToneLike" disabled>More like TONE</button>
        <button id="btnNoiseLike" disabled>More like NOISE</button>
        <span id="tnStatus"></span>
      </div>
    </div>

    <div class="card">
      <h2>Step 2 — Pitch match (A/B)</h2>
      <p>You’ll hear two tones (A then B). Choose which is closer to your tinnitus. We’ll narrow in automatically.</p>
      <div class="row">
        <button id="btnABStart" disabled>Start pitch match</button>
        <button id="btnPickA" disabled>A is closer</button>
        <button id="btnPickB" disabled>B is closer</button>
        <span id="abStatus"></span>
      </div>
      <p>Current estimate: <code id="estimateHz">—</code></p>
    </div>

    <div class="card">
      <h2>Step 3 — Loudness match (relative)</h2>
      <p>Adjust until the played tone matches perceived tinnitus loudness (keep it comfortable).</p>
      <div class="row">
        <button id="btnLoudPlay" disabled>Play at estimate</button>
        <label>Match gain: <input id="matchGain" type="range" min="0" max="0.5" step="0.001" value="0.05"></label>
        <span id="gainVal"></span>
      </div>
    </div>

    <div class="card">
      <h2>Export</h2>
      <div class="row">
        <button id="btnExport" disabled>Download config.json</button>
        <span id="exportStatus"></span>
      </div>
      <pre id="configPreview"></pre>
    </div>

    <script src="./app.js"></script>
  </body>
</html>